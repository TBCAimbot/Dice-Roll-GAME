<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dice Roll Attempts</title>
    <style>
        :root{
            --bg-1:#0f1724;
            --bg-2:#071022;
            --card: rgba(255,255,255,0.04);
            --glass: rgba(255,255,255,0.03);
            --accent-1: #6EE7B7;
            --accent-2: #34D399;
            --muted: #9fb0bd;
            --ui-radius:12px;
            --shadow: 0 8px 30px rgba(2,6,23,0.6);
            --glass-border: rgba(255,255,255,0.04);
        }

        *{box-sizing:border-box}
        html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Roboto, Arial, sans-serif;background:
            radial-gradient(1200px 600px at 10% 10%, rgba(52,211,153,0.06), transparent 10%),
            linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#e6f3f5;-webkit-font-smoothing:antialiased;}

        h2{color:#eaf7f0;margin:0 0 14px 0}

        /* Main layout */
        body { padding: 28px; }
        button { cursor:pointer; transition:transform .12s ease, box-shadow .12s ease; border:0; outline:0; }
        button:active{transform:translateY(1px) scale(.998)}

        /* Top controls and info */
        #money {
            display:inline-block;
            padding:10px 14px;
            background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-radius:10px;
            border:1px solid var(--glass-border);
            box-shadow: var(--shadow);
            color:var(--muted);
            font-weight:600;
            margin-bottom:12px;
        }

        /* Buttons look */
        button {
            background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            color: #e9fbf2;
            padding:10px 14px;
            border-radius:10px;
            font-weight:600;
            box-shadow: 0 6px 18px rgba(2,6,23,0.45), inset 0 -1px 0 rgba(255,255,255,0.01);
        }
        button:hover{
            box-shadow: 0 10px 26px rgba(2,6,23,0.55), 0 0 0 4px rgba(52,211,153,0.04);
            transform:translateY(-2px);
        }
        button.primary{
            background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
            color:#042018;
            box-shadow: 0 8px 30px rgba(52,211,153,0.12);
        }

        /* Upgrades area */
        #upgrades{
            margin-top:10px;
            display:flex;
            gap:8px;
            flex-wrap:wrap;
        }
        .upgrade-btn{
            padding:8px 12px;
            border-radius:10px;
            background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border:1px solid rgba(255,255,255,0.02);
            color:var(--muted);
            font-weight:700;
            cursor:pointer;
        }
        .upgrade-btn:hover{box-shadow:0 8px 18px rgba(2,6,23,0.45); color:#dffbf0}

        /* Output box */
        #output{
            margin-top:18px;
            padding:14px;
            border-radius:12px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
            border:1px solid var(--glass-border);
            color:#d8f7ea;
            max-width:860px;
            white-space:pre-line;
            box-shadow: var(--shadow);
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
            line-height:1.45;
        }

        /* Admin panel - glass card */
        #adminPanel{
            display:none;
            margin-top:18px;
            padding:18px;
            border-radius:14px;
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.04);
            box-shadow: 0 18px 50px rgba(2,6,23,0.6);
            max-width:860px;
        }
        #adminPanel h3{margin-top:0;color:#e8fdf0}

        /* Inputs */
        input[type="number"], input[type="text"], select {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.03);
            color: #e6f8ef;
            padding:8px 10px;
            border-radius:8px;
            margin:4px 0 10px 0;
        }

        label{color:var(--muted);font-size:14px}

        /* Small screens */
        @media (max-width:720px){
            body{padding:14px}
            #output, #adminPanel{max-width:100%}
            button{padding:8px 10px}
        }
    </style>
</head>
<body>
    <h2>Dice Roll Attempts</h2>
    <button onclick="rollDice()">Roll Dice</button>
    <button onclick="startAutoRoll()">Auto Roll</button>
    <button onclick="stopAutoRoll()">Stop Auto</button>
    <div id="money"></div>
    <div id="upgrades"></div>
    <div id="output"></div>

    <!-- Admin Panel UI -->
    <button id="adminBtn" onclick="showAdminPanel()">Admin Panel</button>
    <div id="adminPanel">
        <h3>Admin Panel</h3>
        <label>Attempts: <input type="number" id="adminAttempts"></label><br>
        <label>Money: <input type="number" id="adminMoney"></label><br>
        <div id="adminUpgrades"></div>
        <div id="adminAdminOnly"></div>
        <button onclick="applyAdminChanges()">Apply Changes</button>
        <button onclick="hideAdminPanel()">Close</button>
    </div>

    <script>
        const ADMIN_CODE = "123456789";

        const upgradeTypes = [
            { name: "Double Reward", baseCost: 10 },
            { name: "Faster Auto", baseCost: 25 }
        ];

        const upgradeEffects = [
            function() { rewardMultiplier = 1 + this.level; },
            function() { autoSpeed = Math.max(100, 1000 - this.level * 100); restartAuto(); }
        ];
        const upgradeCostFuncs = [
            function() { return 10 * Math.pow(2, this.level); },
            function() { return 25 * Math.pow(2, this.level); }
        ];

        let upgrades = upgradeTypes.map((type, i) => ({
            name: type.name,
            cost: type.baseCost,
            level: 0,
            effect: upgradeEffects[i],
            costFunc: upgradeCostFuncs[i]
        }));
        let rewardMultiplier = 1;
        let autoSpeed = 1000;

        let attempts = 0;
        let money = 0;
        let autoInterval = null;

        let bestAttempts = 0;
        let currentStreak = 0;
        let bestStreak = 0;

        function updateDisplay() {
            document.getElementById('money').textContent = `Money: $${money} | Best Attempts: ${bestAttempts} | Best Streak: ${bestStreak}`;
            let upgHtml = 'Upgrades: ';
            upgrades.forEach((upg, i) => {
                let nextCost = upg.costFunc.call(upg);
                upgHtml += `<button class="upgrade-btn" onclick="buyUpgrade(${i})" ${money < nextCost ? 'disabled' : ''}>${upg.name} (Lvl ${upg.level}) ($${nextCost})</button>`;
            });
            document.getElementById('upgrades').innerHTML = upgHtml;
        }

        function rollDice() {
            let output = '';
            let firstRoll = Math.floor(Math.random() * 5) + 1;
            output += `First roll: ${firstRoll}\n`;
            if (firstRoll === 5) {
                let secondRoll = Math.floor(Math.random() * 5) + 1;
                output += `Second roll: ${secondRoll}\n`;
                if (secondRoll === 5) {
                    attempts += 1;
                    let earned = attempts * rewardMultiplier;
                    money += earned;
                    currentStreak += 1;
                    bestStreak = Math.max(bestStreak, currentStreak);
                    bestAttempts = Math.max(bestAttempts, attempts);

                    output += `Both rolls were 5! Attempts increased by 1. Earned $${earned}.\n`;
                } else {
                    attempts = Math.max(0, attempts - 1);
                    currentStreak = 0;
                    output += "Second roll was not 5. Attempts decreased by 1.\n";
                }
            } else {
                currentStreak = 0;
                output += "First roll was not 5. No change to attempts.\n";
            }
            output += `Current attempts: ${attempts}\n`;
            output += `Current money: $${money}\n`;
            output += `Best attempts reached: ${bestAttempts}\n`;
            output += `Best consecutive success streak: ${bestStreak}\n`;
            document.getElementById('output').textContent = output;
            updateDisplay();
        }

        function startAutoRoll() {
            if (autoInterval) return;
            autoInterval = setInterval(rollDice, autoSpeed);
        }

        function stopAutoRoll() {
            clearInterval(autoInterval);
            autoInterval = null;
        }

        function restartAuto() {
            stopAutoRoll();
            startAutoRoll();
        }

        window.buyUpgrade = function(i) {
            let upg = upgrades[i];
            let nextCost = upg.costFunc.call(upg);
            if (money >= nextCost) {
                money -= nextCost;
                upg.level += 1;
                upg.effect.call(upg);
                updateDisplay();
            }
        };

        window.showAdminPanel = function() {
            const code = prompt("Enter admin code:");
            if (code === ADMIN_CODE) {
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminAttempts').value = attempts;
                document.getElementById('adminMoney').value = money;

                let upgHtml = '';
                upgrades.forEach((upg, i) => {
                    upgHtml += `<label>${upg.name} Level: <input type="number" id="adminUpg${i}" value="${upg.level}"></label>
<button onclick="removeUpgrade(${i})" style="color:red;">Remove</button><br>`;
                });

                let adminOnlyHtml = '';
                adminOnlyHtml += '<h4>Upgrades</h4>';
                adminOnlyHtml += upgHtml;
                adminOnlyHtml += '<h4>Controls</h4>';
                adminOnlyHtml += `<label>Reward Multiplier: <input type="number" id="adminRewardMultiplier" value="${rewardMultiplier}" step="0.1"></label><br>`;
                adminOnlyHtml += `<label>Auto Speed (ms): <input type="number" id="adminAutoSpeed" value="${autoSpeed}" min="100"></label><br>`;
                adminOnlyHtml += `<label>Best Attempts: <input type="number" id="adminBestAttempts" value="${bestAttempts}" min="0"></label><br>`;

                adminOnlyHtml += '<h4>Add Custom Upgrade</h4>';
                adminOnlyHtml += '<label>Name: <input type="text" id="newUpgradeName" value="Custom Upgrade"></label><br>';
                adminOnlyHtml += '<label>Effect Type:<br>';
                adminOnlyHtml += '<select id="newUpgradeEffectType">';
                adminOnlyHtml += '<option value="rewardMultiplier">Increase Reward Multiplier</option>';
                adminOnlyHtml += '<option value="autoSpeed">Increase Auto Speed</option>';
                adminOnlyHtml += '</select></label><br>';
                adminOnlyHtml += '<label>Cost Scaling:<br>';
                adminOnlyHtml += '<select id="newUpgradeCostType">';
                adminOnlyHtml += '<option value="linear">Linear (baseCost * (level+1))</option>';
                adminOnlyHtml += '<option value="exponential">Exponential (baseCost * 2^level)</option>';
                adminOnlyHtml += '</select></label><br>';
                adminOnlyHtml += '<label>Base Cost: <input type="number" id="newUpgradeCost" value="10"></label><br>';
                adminOnlyHtml += '<button onclick="addUpgrade()">Add Upgrade</button>';

                document.getElementById('adminAdminOnly').innerHTML = adminOnlyHtml;

                document.getElementById('adminRewardMultiplier').value = rewardMultiplier;
                document.getElementById('adminAutoSpeed').value = autoSpeed;
            } else {
                alert("Incorrect code.");
            }
        };

        window.hideAdminPanel = function() {
            document.getElementById('adminPanel').style.display = 'none';
        };

        window.applyAdminChanges = function() {
            attempts = parseInt(document.getElementById('adminAttempts').value) || 0;
            money = parseInt(document.getElementById('adminMoney').value) || 0;
            upgrades.forEach((upg, i) => {
                let el = document.getElementById(`adminUpg${i}`);
                if (el) {
                    let newLevel = parseInt(el.value) || 0;
                    upg.level = newLevel;
                    upg.effect.call(upg);
                }
            });

            let rmEl = document.getElementById('adminRewardMultiplier');
            let asEl = document.getElementById('adminAutoSpeed');
            if (rmEl) rewardMultiplier = parseFloat(rmEl.value) || 1;
            if (asEl) autoSpeed = Math.max(100, parseInt(asEl.value) || 1000);

            let baEl = document.getElementById('adminBestAttempts');
            if (baEl) bestAttempts = Math.max(0, parseInt(baEl.value) || 0);

            updateDisplay();
            restartAuto();
        };

        window.addUpgrade = function() {
            const name = document.getElementById('newUpgradeName').value || 'Custom Upgrade';
            const baseCost = parseInt(document.getElementById('newUpgradeCost').value) || 10;
            const effectType = document.getElementById('newUpgradeEffectType').value;
            const costType = document.getElementById('newUpgradeCostType').value;

            let effect;
            if (effectType === "rewardMultiplier") {
                effect = function() { rewardMultiplier += 1; };
            } else if (effectType === "autoSpeed") {
                effect = function() { autoSpeed = Math.max(100, autoSpeed - 100); restartAuto(); };
            } else {
                effect = function() {};
            }

            let costFunc;
            if (costType === "linear") {
                costFunc = function() { return baseCost * (this.level + 1); };
            } else {
                costFunc = function() { return baseCost * Math.pow(2, this.level); };
            }

            const newUpgrade = {
                name: name,
                cost: baseCost,
                level: 0,
                effect: effect,
                costFunc: costFunc
            };
            upgrades.push(newUpgrade);
            updateDisplay();
            showAdminPanel();
        };

        window.removeUpgrade = function(i) {
            if (confirm('Remove this upgrade?')) {
                upgrades.splice(i, 1);
                updateDisplay();
                showAdminPanel();
            }
        };

        // New JS: small UX improvements, persistence, keyboard shortcuts and animated money
        (function () {
            // toast helper
            function toast(msg, ms = 1400) {
                const t = document.createElement('div');
                t.textContent = msg;
                Object.assign(t.style, {
                    position: 'fixed',
                    right: '20px',
                    bottom: '20px',
                    background: 'linear-gradient(90deg, rgba(6,22,18,0.9), rgba(18,34,30,0.9))',
                    color: '#dffef0',
                    padding: '8px 12px',
                    borderRadius: '10px',
                    boxShadow: '0 10px 30px rgba(2,6,23,0.6)',
                    zIndex: 9999,
                    fontSize: '13px',
                    opacity: '1',
                });
                document.body.appendChild(t);
                setTimeout(() => { t.style.transition = 'opacity .35s'; t.style.opacity = '0'; }, ms);
                setTimeout(() => t.remove(), ms + 400);
            }

            // persist / restore game state
            function saveState() {
                try {
                    const state = {
                        money, attempts, bestAttempts, bestStreak,
                        upgrades: upgrades.map(u => u.level),
                        rewardMultiplier, autoSpeed
                    };
                    localStorage.setItem('dice_state_v1', JSON.stringify(state));
                } catch (e) { /* ignore */ }
            }
            function loadState() {
                try {
                    const s = JSON.parse(localStorage.getItem('dice_state_v1') || 'null');
                    if (!s) return;
                    money = s.money || 0;
                    attempts = s.attempts || 0;
                    bestAttempts = s.bestAttempts || 0;
                    bestStreak = s.bestStreak || 0;
                    rewardMultiplier = s.rewardMultiplier || rewardMultiplier;
                    autoSpeed = s.autoSpeed || autoSpeed;
                    (s.upgrades || []).forEach((lvl, i) => { if (upgrades[i]) upgrades[i].level = lvl; });
                    upgrades.forEach(u => { if (u.effect) u.effect.call(u); });
                } catch (e) { /* ignore */ }
            }

            // animated money display
            let displayedMoney = 0;
            function animateMoneyTo(target) {
                const el = document.getElementById('money');
                const start = displayedMoney;
                const dur = 450;
                const t0 = performance.now();
                function frame(t) {
                    const p = Math.min(1, (t - t0) / dur);
                    displayedMoney = Math.round(start + (target - start) * p);
                    el.textContent = `Money: $${displayedMoney} | Best Attempts: ${bestAttempts} | Best Streak: ${bestStreak}`;
                    if (p < 1) requestAnimationFrame(frame);
                }
                requestAnimationFrame(frame);
            }

            // wrap and augment existing updateDisplay
            const originalUpdate = updateDisplay;
            updateDisplay = function () {
                originalUpdate();
                animateMoneyTo(money);
                saveState();
            };

            // keyboard shortcuts: R roll, A start auto, S stop auto, P toggle admin
            document.addEventListener('keydown', (ev) => {
                if (ev.target && (ev.target.tagName === 'INPUT' || ev.target.tagName === 'TEXTAREA')) return;
                if (ev.key === 'r') { rollDice(); toast('Rolled'); }
                if (ev.key === 'a') { startAutoRoll(); toast('Auto started'); }
                if (ev.key === 's') { stopAutoRoll(); toast('Auto stopped'); }
                if (ev.key === 'p') { document.getElementById('adminBtn')?.click(); }
            });

            // safety: stop auto when window loses focus
            window.addEventListener('blur', () => {
                if (autoInterval) { stopAutoRoll(); toast('Auto stopped (lost focus)'); }
            });

            // save on unload
            window.addEventListener('beforeunload', saveState);

            // load state and refresh UI on start
            loadState();
            displayedMoney = money;
            updateDisplay();
            toast('Welcome â€” state restored');
        })();
    </script>
</body>
</html>
